function exportToPDF() {
  try {
    const results = Array.from(document.querySelectorAll('.result-card')).map(card => {
      const url = card.querySelector('.url').textContent;
      const status = card.querySelector('.status-text').textContent.trim();
      const statusTooltip = card.querySelector('.status-badge').getAttribute('data-tooltip');
      const details = card.querySelector('.details').innerHTML.replace(/<br>/g, '; ');
      const redirectChain = details.includes('Redirect Chain') ? details.split('; ').find(d => d.startsWith('Redirect Chain')).replace('Redirect Chain: ', '') : '-';
      const error = details.includes('Redirect Chain') ? details.split('; ').filter(d => !d.startsWith('Redirect Chain')).join('; ') : details || '-';
      const timestamp = card.querySelector('.timestamp').textContent.replace('Scanned: ', '');
      let condition = '';
      switch (status.toLowerCase()) {
        case 'ok':
          condition = 'Working';
          break;
        case 'broken':
          condition = 'Broken';
          break;
        case 'redirect':
        case 'risky':
        case 'timeout':
        case 'unreachable':
        case 'invalid':
        case 'unknown':
          condition = 'Problematic';
          break;
      }
      return { url, status, statusTooltip, condition, redirectChain, error, timestamp };
    });

    const healthScore = document.getElementById('health-score').textContent;
    const summary = {
      total: document.getElementById('summary-total').textContent,
      ok: document.getElementById('summary-ok').textContent,
      redirects: document.getElementById('summary-redirects').textContent,
      broken: document.getElementById('summary-broken').textContent,
      risky: document.getElementById('summary-risky').textContent
    };

    const generatedDate = new Date().toLocaleString();
    const fileDate = new Date().toISOString().slice(0, 10).replace(/-/g, '');
    const proxyUsed = document.getElementById('use-proxy').checked ? 'Yes' : 'No';

    const exportContent = document.createElement('div');
    exportContent.style.padding = '40px';
    exportContent.style.fontFamily = '"Poppins", sans-serif';
    exportContent.style.color = '#1A1C23';
    exportContent.style.background = '#FFFFFF';
    exportContent.style.position = 'relative';
    exportContent.innerHTML = `
      <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Dancing+Script:wght@700&display=swap');
        table { border-collapse: collapse; width: 100%; margin-bottom: 30px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        th, td { padding: 12px; border: 1px solid #E0E0E0; text-align: left; }
        th { background: #F1F3F5; font-weight: 600; }
        tr:nth-child(even) { background: #F7F9FF; }
        .status-ok { background: #4CAF50; color: #FFFFFF; }
        .status-broken { background: #E53935; color: #FFFFFF; }
        .status-redirect { background: #FFB300; color: #1A1C23; }
        .status-risky { background: #FF5722; color: #FFFFFF; }
        .status-timeout, .status-unreachable, .status-invalid, .status-unknown { background: #6B7280; color: #FFFFFF; }
        .signature { position: absolute; bottom: 20px; left: 40px; font-family: 'Dancing Script', cursive; font-size: 24px; color: #3D5AFE; transform: rotate(-5deg); }
        .watermark { position: fixed; bottom: 10px; right: 20px; font-size: 10px; color: #6B7280; opacity: 0.5; }
        .page-number::after { content: 'Page ' counter(page); position: fixed; bottom: 10px; left: 20px; font-size: 10px; color: #6B7280; }
      </style>
      <div style="text-align: center; padding: 20px; background: linear-gradient(45deg, #3D5AFE, #8C9EFF); border-radius: 12px; margin-bottom: 30px;">
        <img src="assets/logo.svg" alt="LinkCheckr Pro Logo" style="width: 80px; height: 80px; margin-bottom: 15px; filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));">
        <h1 style="font-size: 32px; font-weight: 800; color: #FFFFFF; margin: 0;">LinkCheckr Pro Scan Report</h1>
        <p style="font-size: 18px; font-weight: 500; color: #FFFFFF;">Generated by SIAM on ${generatedDate}</p>
        <p style="font-size: 16px; color: #FFFFFF;">
          <a href="https://m-siam.github.io/LinkChecker-Pro/" style="color: #FFFFFF; text-decoration: none;">https://m-siam.github.io/LinkChecker-Pro/</a>
        </p>
        <p style="font-size: 14px; color: #E6E9FF; margin-top: 5px;">Â© 2025 SIAM. All rights reserved.</p>
      </div>
      <h2 style="font-size: 24px; font-weight: 700; color: #3D5AFE; margin-bottom: 20px;">Scan Summary</h2>
      <table>
        <tr><th>Metric</th><th>Value</th></tr>
        <tr><td>Link Health</td><td>${healthScore}</td></tr>
        <tr><td>Total Links</td><td>${summary.total}</td></tr>
        <tr><td>OK</td><td>${summary.ok}</td></tr>
        <tr><td>Redirects</td><td>${summary.redirects}</td></tr>
        <tr><td>Broken</td><td>${summary.broken}</td></tr>
        <tr><td>Risky</td><td>${summary.risky}</td></tr>
        <tr><td>Proxy Used</td><td>${proxyUsed}</td></tr>
      </table>
      <h2 style="font-size: 24px; font-weight: 700; color: #3D5AFE; margin-bottom: 20px;">Detailed Results</h2>
      <table>
        <thead>
          <tr>
            <th style="width: 25%;">URL</th>
            <th style="width: 10%;">Status</th>
            <th style="width: 10%;">Condition</th>
            <th style="width: 20%;">Status Description</th>
            <th style="width: 20%;">Redirect Chain</th>
            <th style="width: 10%;">Error</th>
            <th style="width: 10%;">Timestamp</th>
          </tr>
        </thead>
        <tbody>
          ${results.map(result => `
            <tr>
              <td style="word-break: break-all;">${result.url}</td>
              <td class="status-${result.status.toLowerCase()}">${result.status}</td>
              <td>${result.condition}</td>
              <td>${result.statusTooltip}</td>
              <td>${result.redirectChain}</td>
              <td>${result.error}</td>
              <td>${result.timestamp}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
      <div class="signature">SIAM, Website Owner</div>
      <div class="watermark">LinkCheckr Pro - https://m-siam.github.io/LinkChecker-Pro/</div>
      <div class="page-number"></div>
    `;

    const opt = {
      margin: [0.75, 0.5, 0.75, 0.5],
      filename: `LinkCheckr_Pro_Scan_${fileDate}.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2, useCORS: true },
      jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' },
      pagebreak: { mode: ['css', 'legacy'] }
    };

    html2pdf().from(exportContent).set(opt).save().catch(err => {
      console.error('PDF export failed:', err);
      showToast('Failed to export PDF. Please try again.', 'error');
    });
  } catch (err) {
    console.error('PDF export error:', err);
    showToast('Failed to export PDF. Please try again.', 'error');
  }
}
